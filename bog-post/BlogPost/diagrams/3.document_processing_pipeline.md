sequenceDiagram autonumber participant S3 as ü™£ S3 Documents participant Start as Œª
textract-start.handler participant DynamoDB as üìä DynamoDB participant Textract as üìÑ
Textract participant SNS as üì® SNS Topic participant Complete as Œª
textract-complete.handler participant Bedrock as üß† Bedrock Titan participant OpenSearch
as üîç OpenSearch

    S3->>Start: S3 ObjectCreated Event<br/>{bucket, key}

    Start->>S3: HeadObject (validate PDF)
    S3-->>Start: File metadata

    Start->>DynamoDB: Update status: PROCESSING

    Start->>Textract: StartDocumentTextDetection<br/>(async job)
    Textract-->>Start: {JobId}

    Start->>DynamoDB: Save JobId to Jobs table
    Start-->>S3: ‚úÖ Processing started

    Note over Textract: ‚è≥ OCR Processing<br/>(30s - 5min)

    Textract->>SNS: Job Complete Notification
    SNS->>Complete: SNS Event {JobId, Status}

    Complete->>Textract: GetDocumentTextDetection<br/>(paginated results)
    Textract-->>Complete: Extracted text & blocks

    loop For each text chunk
        Complete->>Bedrock: Generate embedding<br/>(Titan Embeddings)
        Bedrock-->>Complete: Vector [1536 dims]
        Complete->>OpenSearch: Index chunk + vector
    end

    Complete->>S3: Store full extracted text
    Complete->>DynamoDB: Update status: COMPLETED

    Note over OpenSearch: ‚úÖ Document searchable
